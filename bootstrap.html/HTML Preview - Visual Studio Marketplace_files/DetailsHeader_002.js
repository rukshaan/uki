define("OfficeFabric/components/DetailsList/DetailsHeader",["require","exports","tslib","react","react-dom","../../Utilities","./DetailsList.types","../../FocusZone","../../Icon","../../Layer","../GroupedList/GroupSpacer","../../GroupedList","./DetailsRowCheck","./DetailsRowCheck.scss","../../utilities/selection/interfaces","./DetailsHeader.scss"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function rt(n){n.stopPropagation()}var d;Object.defineProperty(t,"__esModule",{value:!0});var w=p,k=v,g=0,nt=1,tt=16,it=24,b;(function(n){n[n.none=0]="none";n[n.hidden=1]="hidden";n[n.visible=2]="visible"})(b=t.SelectAllVisibility||(t.SelectAllVisibility={}));d=function(n){function t(t){var u=n.call(this,t)||this;return u._root=f.createRef(),u._onRenderColumnHeaderTooltip=function(n){return r.createElement("span",{className:n.hostClassName},n.children)},u._onSelectAllClicked=function(){var n=u.props.selection;n.toggleAllSelected()},u._onRootMouseDown=function(n){var t=n.target.getAttribute("data-sizer-index"),i=Number(t),r=u.props.columns;t!==null&&n.button===g&&(u.setState({columnResizeDetails:{columnIndex:i,columnMinWidth:r[i].calculatedWidth,originX:n.clientX}}),n.preventDefault(),n.stopPropagation())},u._onRootMouseMove=function(n){var t=u.state,i=t.columnResizeDetails,r=t.isSizing;i&&!r&&n.clientX!==i.originX&&u.setState({isSizing:!0})},u._onRootKeyDown=function(n){var o=u.state,e=o.columnResizeDetails,a=o.isSizing,s=u.props,h=s.columns,c=s.onColumnResized,l=n.target.getAttribute("data-sizer-index"),r,t;l&&!a&&(r=Number(l),e?(t=void 0,n.which===13?(u.setState({columnResizeDetails:undefined}),n.preventDefault(),n.stopPropagation()):n.which===37?t=f.getRTL()?1:-1:n.which===39&&(t=f.getRTL()?-1:1),t&&(n.shiftKey||(t*=10),u.setState({columnResizeDetails:i.__assign({},e,{columnMinWidth:e.columnMinWidth+t})}),c&&c(h[r],e.columnMinWidth+t,r),n.preventDefault(),n.stopPropagation())):n.which===13&&(u.setState({columnResizeDetails:{columnIndex:r,columnMinWidth:h[r].calculatedWidth}}),n.preventDefault(),n.stopPropagation()))},u._onSizerMouseMove=function(n){var e=n.buttons,r=u.props,o=r.onColumnIsSizingChanged,s=r.onColumnResized,h=r.columns,t=u.state.columnResizeDetails,i;if(e!==undefined&&e!==nt){u._onSizerMouseUp(n);return}n.clientX!==t.originX&&o&&o(h[t.columnIndex],!0);s&&(i=n.clientX-t.originX,f.getRTL()&&(i=-i),s(h[t.columnIndex],t.columnMinWidth+i,t.columnIndex))},u._onSizerBlur=function(){var n=u.state.columnResizeDetails;n&&u.setState({columnResizeDetails:undefined,isSizing:!1})},u._onSizerMouseUp=function(){var n=u.props,i=n.columns,t=n.onColumnIsSizingChanged,r=u.state.columnResizeDetails;u.setState({columnResizeDetails:undefined,isSizing:!1});t&&t(i[r.columnIndex],!1)},u.state={columnResizeDetails:undefined,groupNestingDepth:u.props.groupNestingDepth,isAllCollapsed:u.props.isAllCollapsed},u._onToggleCollapseAll=u._onToggleCollapseAll.bind(u),u._onSelectAllClicked=u._onSelectAllClicked.bind(u),u._id=f.getId("header"),u}return i.__extends(t,n),t.prototype.componentDidMount=function(){var t=this.props.selection,i=this._root.current,n=u.findDOMNode(i);this._events.on(t,y.SELECTION_CHANGE,this._onSelectionChanged);this._events.on(n,"mousedown",this._onRootMouseDown);this._events.on(n,"keydown",this._onRootKeyDown)},t.prototype.componentWillReceiveProps=function(n){var t=this.state.groupNestingDepth;n.groupNestingDepth!==t&&this.setState({groupNestingDepth:n.groupNestingDepth})},t.prototype.render=function(){var n=this,t=this.props,ut=t.columns,ft=t.ariaLabel,u=t.ariaLabelForSelectAllCheckbox,p=t.selectAllVisibility,et=t.ariaLabelForSelectionColumn,ot=t.preventUserInteractionEventHandlers,i=this.state,v=i.isAllSelected,st=i.columnResizeDetails,y=i.isSizing,d=i.groupNestingDepth,ht=i.isAllCollapsed,g=p!==b.none,nt=this.props.onRenderColumnHeaderTooltip,rt=nt===void 0?this._onRenderColumnHeaderTooltip:nt;return r.createElement(o.FocusZone,{role:"row","aria-label":ft,className:f.css("ms-DetailsHeader",w.root,v&&"is-allSelected "+w.rootIsAllSelected,p===b.hidden&&"is-selectAllHidden "+w.rootIsSelectAllHidden,!!st&&y&&"is-resizingColumn"),componentRef:this._root,onMouseMove:this._onRootMouseMove,"data-automationid":"DetailsHeader",direction:o.FocusZoneDirection.horizontal,disabled:ot},g?[r.createElement("div",{key:"__checkbox",className:f.css("ms-DetailsHeader-cell","ms-DetailsHeader-cellIsCheck",w.cell,w.cellIsCheck,k.owner,v&&k.isSelected),"aria-labelledby":this._id+"-check",onClick:this.props.selection?this._onSelectAllClicked:undefined,"aria-colindex":1,role:"columnheader"},rt({hostClassName:f.css(w.checkTooltip),id:this._id+"-checkTooltip",setAriaDescribedBy:!1,content:u,children:r.createElement(a.DetailsRowCheck,{id:this._id+"-check","aria-label":et,"aria-describedby":this._id+"-checkTooltip","data-is-focusable":!0,isHeader:!0,selected:v,anySelected:!1,canSelect:!0})},this._onRenderColumnHeaderTooltip)),u&&!this.props.onRenderColumnHeaderTooltip?r.createElement("label",{key:"__checkboxLabel",id:this._id+"-checkTooltip",className:w.accessibleLabel},u):null]:null,d>0&&this.props.collapseAllVisibility===l.CollapseAllVisibility.visible?r.createElement("div",{className:f.css("ms-DetailsHeader-cell",w.cell),onClick:this._onToggleCollapseAll,"data-is-focusable":!0},r.createElement(s.Icon,{className:f.css("ms-DetailsHeader-collapseButton",w.collapseButton,ht&&"is-collapsed "+w.collapseButtonIsCollapsed),iconName:"ChevronDown"})):null,c.GroupSpacer({count:d-1}),ut.map(function(t,i){return[r.createElement("div",{key:t.key,role:"columnheader","aria-sort":t.isSorted?t.isSortedDescending?"descending":"ascending":"none","aria-colindex":(g?2:1)+i,className:f.css("ms-DetailsHeader-cell",w.cell,t.headerClassName,t.columnActionsMode!==e.ColumnActionsMode.disabled&&"is-actionable "+w.cellIsActionable,!t.name&&"is-empty "+w.cellIsEmpty,(t.isSorted||t.isGrouped||t.isFiltered)&&"is-icon-visible",t.isPadded&&w.cellWrapperPadded),style:{width:t.calculatedWidth+tt+(t.isPadded?it:0)},"data-automationid":"ColumnsHeaderColumn","data-item-key":t.key},rt({hostClassName:f.css(w.cellTooltip),id:n._id+"-"+t.key+"-tooltip",setAriaDescribedBy:!1,content:t.columnActionsMode!==e.ColumnActionsMode.disabled?t.ariaLabel:"",children:r.createElement("span",{id:n._id+"-"+t.key,"aria-label":t.isIconOnly?t.name:undefined,"aria-labelledby":t.isIconOnly?undefined:n._id+"-"+t.key+"-name ",className:f.css("ms-DetailsHeader-cellTitle",w.cellTitle),"data-is-focusable":t.columnActionsMode!==e.ColumnActionsMode.disabled,role:t.columnActionsMode!==e.ColumnActionsMode.disabled?"button":undefined,"aria-describedby":n.props.onRenderColumnHeaderTooltip?n._id+"-"+t.key+"-tooltip":undefined,onContextMenu:n._onColumnContextMenu.bind(n,t),onClick:t.columnActionsMode!==e.ColumnActionsMode.disabled?n._onColumnClick.bind(n,t):undefined,"aria-haspopup":t.columnActionsMode===e.ColumnActionsMode.hasDropdown},r.createElement("span",{id:n._id+"-"+t.key+"-name",className:f.css("ms-DetailsHeader-cellName",w.cellName,(u={},u[w.iconOnlyHeader]=t.isIconOnly,u))},(t.iconName||t.iconClassName)&&r.createElement(s.Icon,{className:f.css(w.nearIcon,t.iconClassName),iconName:t.iconName}),t.isIconOnly?undefined:t.name),t.isFiltered&&r.createElement(s.Icon,{className:w.nearIcon,iconName:"Filter"}),t.isSorted&&r.createElement(s.Icon,{className:f.css(w.nearIcon,w.sortIcon),iconName:t.isSortedDescending?"SortDown":"SortUp"}),t.isGrouped&&r.createElement(s.Icon,{className:w.nearIcon,iconName:"GroupedDescending"}),t.columnActionsMode===e.ColumnActionsMode.hasDropdown&&!t.isIconOnly&&r.createElement(s.Icon,{className:f.css("ms-DetailsHeader-filterChevron",w.filterChevron),iconName:"ChevronDown"}))},n._onRenderColumnHeaderTooltip)),t.ariaLabel&&!n.props.onRenderColumnHeaderTooltip?r.createElement("label",{key:t.key+"_label",id:n._id+"-"+t.key+"-tooltip",className:w.accessibleLabel},t.ariaLabel):null,t.isResizable&&n._renderColumnSizer(i)];var u}),y&&r.createElement(h.Layer,null,r.createElement("div",{className:f.css(y&&w.sizingOverlay),onMouseMove:this._onSizerMouseMove,onMouseUp:this._onSizerMouseUp})))},t.prototype.focus=function(){return Boolean(this._root.current&&this._root.current.focus())},t.prototype._renderColumnSizer=function(n){var u=this.props.columns,e=this.props.columns[n],i=this.state.columnResizeDetails,t;return r.createElement("div",{key:e.key+"_sizer","aria-hidden":!0,role:"button","data-is-focusable":!1,onClick:rt,"data-sizer-index":n,onBlur:this._onSizerBlur,className:f.css("ms-DetailsHeader-cellSizer",w.cellSizer,n<u.length-1?w.cellSizerStart:w.cellSizerEnd,(t={},t["is-resizing "+w.cellIsResizing]=i&&i.columnIndex===n,t)),onDoubleClick:this._onSizerDoubleClick.bind(this,n)})},t.prototype._onSizerDoubleClick=function(n){var t=this.props,i=t.onColumnAutoResized,r=t.columns;i&&i(r[n],n)},t.prototype._onSelectionChanged=function(){var n=this.props.selection.isAllSelected();this.state.isAllSelected!==n&&this.setState({isAllSelected:n})},t.prototype._onColumnClick=function(n,t){var i=this.props.onColumnClick;if(n.onColumnClick)n.onColumnClick(t,n);i&&i(t,n)},t.prototype._onColumnContextMenu=function(n,t){var i=this.props.onColumnContextMenu;if(n.onColumnContextMenu){n.onColumnContextMenu(n,t);t.preventDefault()}i&&(i(n,t),t.preventDefault())},t.prototype._onToggleCollapseAll=function(){var n=this.props.onToggleCollapseAll,t=!this.state.isAllCollapsed;this.setState({isAllCollapsed:t});n&&n(t)},t.defaultProps={selectAllVisibility:b.visible,collapseAllVisibility:l.CollapseAllVisibility.visible},t}(f.BaseComponent);t.DetailsHeader=d});

