define("OfficeFabric/utilities/selection/SelectionZone",["require","exports","tslib","react","../../Utilities","./interfaces"],function(n,t,i,r,u,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c="data-selection-disabled",s="data-selection-index",e="data-selection-toggle",o="data-selection-invoke",h="data-selection-all-toggle",l="data-selection-select",a=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._root=u.createRef(),t.ignoreNextFocus=function(){t._handleNextFocus(!1)},t._onMouseDownCapture=function(n){if(document.activeElement!==n.target&&!u.elementContains(document.activeElement,n.target)){t.ignoreNextFocus();return}if(u.elementContains(n.target,t._root.current))for(var i=n.target;i!==t._root.current;){if(t._hasAttribute(i,o)){t.ignoreNextFocus();break}i=u.getParent(i)}},t._onFocus=function(n){var o=n.target,i=t.props.selection,h=t._isCtrlPressed||t._isMetaPressed,c=t._getSelectionMode(),s,u,r;t._shouldHandleFocus&&c!==f.SelectionMode.none&&(s=t._hasAttribute(o,e),u=t._findItemRoot(o),!s&&u&&(r=t._getItemIndex(u),h?(i.setIndexSelected(r,i.isIndexSelected(r),!0),t.props.enterModalOnTouch&&t._isTouch&&i.setModal&&(i.setModal(!0),t._setIsTouch(!1))):t.props.isSelectedOnFocus&&t._onItemSurfaceClick(n,r)));t._handleNextFocus(!1)},t._onMouseDown=function(n){t._updateModifiers(n);var i=n.target,r=t._findItemRoot(i);if(!t._isSelectionDisabled(i))while(i!==t._root.current){if(t._hasAttribute(i,h))break;else if(r)if(t._hasAttribute(i,e))break;else if(t._hasAttribute(i,o))break;else if(i!==r&&!t._shouldAutoSelect(i)||t._isShiftPressed||t._isCtrlPressed){if(t.props.disableAutoSelectOnInputElements&&(i.tagName==="A"||i.tagName==="BUTTON"||i.tagName==="INPUT"))return}else{t._onInvokeMouseDown(n,t._getItemIndex(r));break}i=u.getParent(i)}},t._onTouchStartCapture=function(){t._setIsTouch(!0)},t._onClick=function(n){var i,f,r;if(t._updateModifiers(n),i=n.target,f=t._findItemRoot(i),!t._isSelectionDisabled(i))while(i!==t._root.current){if(t._hasAttribute(i,h)){t._onToggleAllClick(n);break}else if(f)if(r=t._getItemIndex(f),t._hasAttribute(i,e)){t._isShiftPressed?t._onItemSurfaceClick(n,r):t._onToggleClick(n,r);break}else if(t._hasAttribute(i,o)){t._onInvokeClick(n,r);break}else if(i===f){t._onItemSurfaceClick(n,r);break}else if(i.tagName==="A"||i.tagName==="BUTTON"||i.tagName==="INPUT")return;i=u.getParent(i)}},t._onContextMenu=function(n){var o=n.target,u=t.props,f=u.onItemContextMenu,s=u.selection,i,r,e;f&&(i=t._findItemRoot(o),i&&(r=t._getItemIndex(i),e=f(s.getItems()[r],r,n.nativeEvent),e||n.preventDefault()))},t._onDoubleClick=function(n){var i=n.target,s;if(!t._isSelectionDisabled(i)){var h=t.props.onItemInvoked,r=t._findItemRoot(i),c=t._getSelectionMode();if(r&&h&&c!==f.SelectionMode.none&&!t._isInputElement(i)){for(s=t._getItemIndex(r);i!==t._root.current;){if(t._hasAttribute(i,e)||t._hasAttribute(i,o))break;else if(i===r){t._onInvokeClick(n,s);break}i=u.getParent(i)}i=u.getParent(i)}}},t._onKeyDownCapture=function(n){t._updateModifiers(n);t._handleNextFocus(!0)},t._onKeyDown=function(n){var i,h,o,s;if(t._updateModifiers(n),i=n.target,!t._isSelectionDisabled(i)){var r=t.props.selection,c=n.which===65&&(t._isCtrlPressed||t._isMetaPressed),l=n.which===27;if(!t._isInputElement(i)){if(h=t._getSelectionMode(),c&&h===f.SelectionMode.multiple&&!r.isAllSelected()){r.setAllSelected(!0);n.stopPropagation();n.preventDefault();return}if(l&&r.getSelectedCount()>0){r.setAllSelected(!1);n.stopPropagation();n.preventDefault();return}if(o=t._findItemRoot(i),o)for(s=t._getItemIndex(o);i!==t._root.current;){if(t._hasAttribute(i,e))break;else if(t._shouldAutoSelect(i)){t._onInvokeMouseDown(n,s);break}else{if((n.which===13||n.which===32)&&(i.tagName==="BUTTON"||i.tagName==="A"||i.tagName==="INPUT"))return!1;if(i===o){if(n.which===13){t._onInvokeClick(n,s);n.preventDefault();return}if(n.which===32){t._onToggleClick(n,s);n.preventDefault();return}break}}i=u.getParent(i)}}}},t}return i.__extends(t,n),t.prototype.componentDidMount=function(){var n=u.getWindow(this._root.current),t=u.findScrollableParent(this._root.current);this._events.on(n,"keydown, keyup",this._updateModifiers,!0);this._events.on(t,"click",this._tryClearOnEmptyClick);this._events.on(document.body,"touchstart",this._onTouchStartCapture,!0);this._events.on(document.body,"touchend",this._onTouchStartCapture,!0)},t.prototype.render=function(){return r.createElement("div",i.__assign({className:"ms-SelectionZone",ref:this._root,onKeyDown:this._onKeyDown,onMouseDown:this._onMouseDown,onKeyDownCapture:this._onKeyDownCapture,onClick:this._onClick,role:"presentation",onDoubleClick:this._onDoubleClick,onContextMenu:this._onContextMenu},{onMouseDownCapture:this._onMouseDownCapture,onFocusCapture:this._onFocus}),this.props.children)},t.prototype._isSelectionDisabled=function(n){while(n!==this._root.current){if(this._hasAttribute(n,c))return!0;n=u.getParent(n)}return!1},t.prototype._onToggleAllClick=function(n){var t=this.props.selection,i=this._getSelectionMode();i===f.SelectionMode.multiple&&(t.toggleAllSelected(),n.stopPropagation(),n.preventDefault())},t.prototype._onToggleClick=function(n,t){var i=this.props.selection,r=this._getSelectionMode(),u;if(i.setChangeEvents(!1),this.props.enterModalOnTouch&&this._isTouch&&!i.isIndexSelected(t)&&i.setModal&&(i.setModal(!0),this._setIsTouch(!1)),r===f.SelectionMode.multiple)i.toggleIndexSelected(t);else if(r===f.SelectionMode.single)u=i.isIndexSelected(t),i.setAllSelected(!1),i.setIndexSelected(t,!u,!0);else{i.setChangeEvents(!0);return}i.setChangeEvents(!0);n.stopPropagation()},t.prototype._onInvokeClick=function(n,t){var i=this.props,u=i.selection,r=i.onItemInvoked;r&&(r(u.getItems()[t],t,n.nativeEvent),n.preventDefault(),n.stopPropagation())},t.prototype._onItemSurfaceClick=function(n,t){var i=this.props.selection,r=this._isCtrlPressed||this._isMetaPressed,u=this._getSelectionMode();u===f.SelectionMode.multiple?this._isShiftPressed?i.selectToIndex(t,!r):r?i.toggleIndexSelected(t):this._clearAndSelectIndex(t):u===f.SelectionMode.single&&this._clearAndSelectIndex(t)},t.prototype._onInvokeMouseDown=function(n,t){var i=this.props.selection;i.isIndexSelected(t)||this._clearAndSelectIndex(t)},t.prototype._tryClearOnEmptyClick=function(n){!this.props.selectionPreservedOnEmptyClick&&this._isNonHandledClick(n.target)&&this.props.selection.setAllSelected(!1)},t.prototype._clearAndSelectIndex=function(n){var t=this.props.selection,i=t.getSelectedCount()===1&&t.isIndexSelected(n);i||(t.setChangeEvents(!1),t.setAllSelected(!1),t.setIndexSelected(n,!0,!0),this.props.enterModalOnTouch&&this._isTouch&&t.setModal&&(t.setModal(!0),this._setIsTouch(!1)),t.setChangeEvents(!0))},t.prototype._updateModifiers=function(n){this._isShiftPressed=n.shiftKey;this._isCtrlPressed=n.ctrlKey;this._isMetaPressed=n.metaKey},t.prototype._findItemRoot=function(n){for(var r=this.props.selection,t,i;n!==this._root.current;){if(t=n.getAttribute(s),i=Number(t),t!==null&&i>=0&&i<r.getItems().length)break;n=u.getParent(n)}return n===this._root.current?undefined:n},t.prototype._getItemIndex=function(n){return Number(n.getAttribute(s))},t.prototype._shouldAutoSelect=function(n){return this._hasAttribute(n,l)},t.prototype._hasAttribute=function(n,t){for(var i=!1;!i&&n!==this._root.current;)i=n.getAttribute(t)==="true",n=u.getParent(n);return i},t.prototype._isInputElement=function(n){return n.tagName==="INPUT"||n.tagName==="TEXTAREA"},t.prototype._isNonHandledClick=function(n){var t=u.getDocument();if(t&&n)while(n&&n!==t.documentElement){if(u.isElementTabbable(n))return!1;n=u.getParent(n)}return!0},t.prototype._handleNextFocus=function(n){var t=this;this._shouldHandleFocusTimeoutId&&(this._async.clearTimeout(this._shouldHandleFocusTimeoutId),this._shouldHandleFocusTimeoutId=undefined);this._shouldHandleFocus=n;n&&this._async.setTimeout(function(){t._shouldHandleFocus=!1},100)},t.prototype._setIsTouch=function(n){var t=this;this._isTouchTimeoutId&&(this._async.clearTimeout(this._isTouchTimeoutId),this._isTouchTimeoutId=undefined);this._isTouch=!0;n&&this._async.setTimeout(function(){t._isTouch=!1},300)},t.prototype._getSelectionMode=function(){var n=this.props.selection,t=this.props.selectionMode;return t===void 0?n?n.mode:f.SelectionMode.none:t},t.defaultProps={isMultiSelectEnabled:!0,isSelectedOnFocus:!0,selectionMode:f.SelectionMode.multiple},t}(u.BaseComponent);t.SelectionZone=a});

