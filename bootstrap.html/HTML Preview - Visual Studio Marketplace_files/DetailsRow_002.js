define("OfficeFabric/components/DetailsList/DetailsRow",["require","exports","tslib","react","react-dom","../../Utilities","./DetailsList.types","./DetailsRowCheck","../GroupedList/GroupSpacer","./DetailsRowFields","../../FocusZone","../../utilities/selection/interfaces","../../GroupedList","../../Styling","./DetailsRow.scss","./DetailsRowCheck.scss"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=y,b=p,k="is-dropping",d=function(n){function t(t){var i=n.call(this,t)||this;return i._cellMeasurer=f.createRef(),i._focusZone=f.createRef(),i._onRootRef=function(n){i._root=n?u.findDOMNode(n):undefined},i.state={selectionState:i._getSelectionState(t),columnMeasureInfo:undefined,isDropping:!1,groupNestingDepth:t.groupNestingDepth},i._droppingClassNames="",i._updateDroppingState=i._updateDroppingState.bind(i),i._onToggleSelection=i._onToggleSelection.bind(i),i}return i.__extends(t,n),t.prototype.componentDidMount=function(){var n=this.props.dragDropHelper;n&&(this._dragDropSubscription=n.subscribe(this._root,this._events,this._getRowDragDropOptions()));this._events.on(this.props.selection,l.SELECTION_CHANGE,this._onSelectionChanged);if(this.props.onDidMount&&this.props.item){this._hasMounted=!0;this.props.onDidMount(this)}},t.prototype.componentDidUpdate=function(n){var f=this.state,i=this.props,e=i.item,r=i.onDidMount,t=f.columnMeasureInfo,u;if((this.props.itemIndex!==n.itemIndex||this.props.item!==n.item||this.props.dragDropHelper!==n.dragDropHelper)&&(this._dragDropSubscription&&(this._dragDropSubscription.dispose(),delete this._dragDropSubscription),this.props.dragDropHelper&&(this._dragDropSubscription=this.props.dragDropHelper.subscribe(this._root,this._events,this._getRowDragDropOptions()))),t&&t.index>=0&&this._cellMeasurer.current){u=this._cellMeasurer.current.getBoundingClientRect().width;t.onMeasureDone(u);this.setState({columnMeasureInfo:undefined})}e&&r&&!this._hasMounted&&(this._hasMounted=!0,r(this))},t.prototype.componentWillUnmount=function(){var n=this.props,i=n.item,t=n.onWillUnmount;t&&i&&t(this);this._dragDropSubscription&&(this._dragDropSubscription.dispose(),delete this._dragDropSubscription)},t.prototype.componentWillReceiveProps=function(n){this.setState({selectionState:this._getSelectionState(n),groupNestingDepth:n.groupNestingDepth})},t.prototype.render=function(){var n=this.props,kt=n.className,tt=n.columns,d=n.dragDropEvents,t=n.item,o=n.itemIndex,it=n.onRenderCheck,dt=it===void 0?this._onRenderCheck:it,rt=n.onRenderItemColumn,g=n.selectionMode,ut=n.viewport,ft=n.checkboxVisibility,et=n.getRowAriaLabel,ot=n.getRowAriaDescribedBy,gt=n.checkButtonAriaLabel,ni=n.checkboxCellClassName,st=n.rowFieldsAs,ht=st===void 0?h.DetailsRowFields:st,ti=n.selection,ct=n.shimmer,ii=n.compact,nt=this.state,lt=nt.columnMeasureInfo,ri=nt.isDropping,ui=nt.groupNestingDepth,at=this.state.selectionState,vt=at.isSelected,y=vt===void 0?!1:vt,yt=at.isSelectionModal,pt=yt===void 0?!1:yt,wt=Boolean(d&&d.canDrag&&d.canDrag(t)),fi=ri?this._droppingClassNames?this._droppingClassNames:k:"",ei=et?et(t):undefined,oi=ot?ot(t):undefined,si=ti.canSelectItem(t),hi=g===l.SelectionMode.multiple,p=g!==l.SelectionMode.none&&ft!==e.CheckboxVisibility.hidden,ci=g===l.SelectionMode.none?undefined:y,bt=r.createElement(ht,{columns:tt,item:t,itemIndex:o,columnStartIndex:p?1:0,onRenderItemColumn:rt,shimmer:ct}),u;return ct?r.createElement("div",{className:f.css(p&&w.shimmerLeftBorder,!ii&&w.shimmerBottomBorder)},bt):r.createElement(c.FocusZone,i.__assign({},f.getNativeProps(this.props,f.divProperties),{direction:c.FocusZoneDirection.horizontal,ref:this._onRootRef,componentRef:this._focusZone,role:"row","aria-label":ei,ariaDescribedBy:oi,className:f.css("ms-DetailsRow",kt,v.AnimationClassNames.fadeIn400,w.root,b.owner,fi,(u={},u["is-contentUnselectable "+w.rootIsContentUnselectable]=hi,u["is-selected "+b.isSelected+" "+w.rootIsSelected]=y,u[w.anySelected+" "+b.anySelected]=pt,u["is-check-visible "+b.isVisible]=ft===e.CheckboxVisibility.always,u)),"data-is-focusable":!0,"data-selection-index":o,"data-item-index":o,"aria-rowindex":this._adjustAriaRowIndex(o)+1,"data-is-draggable":wt,draggable:wt,"data-automationid":"DetailsRow",style:{minWidth:ut?ut.width:0},"aria-selected":ci,allowFocusRoot:!0}),p&&r.createElement("div",{role:"gridcell","aria-colindex":1,"data-selection-toggle":!0,className:f.css("ms-DetailsRow-cell","ms-DetailsRow-cellCheck",b.owner,w.cell,w.checkCell,ni)},dt({selected:y,anySelected:pt,title:gt,canSelect:si})),s.GroupSpacer({count:ui-(this.props.collapseAllVisibility===a.CollapseAllVisibility.hidden?1:0)}),t&&bt,lt&&r.createElement("span",{role:"presentation",className:f.css("ms-DetailsRow-cellMeasurer ms-DetailsRow-cell",w.cellMeasurer,w.cell),ref:this._cellMeasurer},r.createElement(ht,{columns:[lt.column],item:t,itemIndex:o,columnStartIndex:(p?1:0)+tt.length,onRenderItemColumn:rt})),r.createElement("span",{role:"checkbox",className:f.css(w.checkCover),"aria-checked":y,"data-selection-toggle":!0}))},t.prototype.measureCell=function(n,t){var i=f.assign({},this.props.columns[n]);i.minWidth=0;i.maxWidth=999999;delete i.calculatedWidth;this.setState({columnMeasureInfo:{index:n,column:i,onMeasureDone:t}})},t.prototype.focus=function(n){return n===void 0&&(n=!1),!!this._focusZone.current&&this._focusZone.current.focus(n)},t.prototype._onRenderCheck=function(n){return r.createElement(o.DetailsRowCheck,i.__assign({},n))},t.prototype._adjustAriaRowIndex=function(n){return n+(this.props.shouldShiftItemAriaIndex?1:0)},t.prototype._getSelectionState=function(n){var i=n.itemIndex,t=n.selection;return{isSelected:t.isIndexSelected(i),isSelectionModal:!!t.isModal&&t.isModal()}},t.prototype._onSelectionChanged=function(){var n=this._getSelectionState(this.props);f.shallowCompare(n,this.state.selectionState)||this.setState({selectionState:n})},t.prototype._onToggleSelection=function(){var n=this.props.selection;n.toggleIndexSelected(this.props.itemIndex)},t.prototype._getRowDragDropOptions=function(){var t=this.props,r=t.item,i=t.itemIndex,n=t.dragDropEvents,u=t.eventsToRegister;return{eventMap:u,selectionIndex:i,context:{data:r,index:i},canDrag:n.canDrag,canDrop:n.canDrop,onDragStart:n.onDragStart,updateDropState:this._updateDroppingState,onDrop:n.onDrop,onDragEnd:n.onDragEnd}},t.prototype._updateDroppingState=function(n,t){var r=this.state,e=r.selectionState,o=r.isDropping,u=this.props,i=u.dragDropEvents,f=u.item;if(n)i.onDragEnter&&(this._droppingClassNames=i.onDragEnter(f,t));else if(i.onDragLeave)i.onDragLeave(f,t);o!==n&&this.setState({selectionState:e,isDropping:n})},t}(f.BaseComponent);t.DetailsRow=d});

