define("OfficeFabric/utilities/selection/Selection",["require","exports","./interfaces","../../Utilities"],function(n,t,i,r){"use strict";function f(n,t){return n&&n.key?n.key:""+t}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function n(n){n===void 0&&(n={});var u=n.onSelectionChanged,e=n.getKey,t=n.canSelectItem,o=t===void 0?function(){return!0}:t,r=n.selectionMode,s=r===void 0?i.SelectionMode.multiple:r;this.mode=s;this._getKey=e||f;this._changeEventSuppressionCount=0;this._exemptedCount=0;this._anchoredIndex=0;this._unselectableCount=0;this._onSelectionChanged=u;this._canSelectItem=o;this._isModal=!1;this.setItems([],!0)}return n.prototype.canSelectItem=function(n){return this._canSelectItem(n)},n.prototype.getKey=function(n,t){var i=this._getKey(n,t);return typeof i=="number"||i?""+i:""},n.prototype.setChangeEvents=function(n,t){this._changeEventSuppressionCount+=n?-1:1;this._changeEventSuppressionCount===0&&this._hasChanged&&(this._hasChanged=!1,t||this._change())},n.prototype.isModal=function(){return this._isModal},n.prototype.setModal=function(n){this._isModal!==n&&(this.setChangeEvents(!1),this._isModal=n,n||this.setAllSelected(!1),this._change(),this.setChangeEvents(!0))},n.prototype.setItems=function(n,t){var i,r,s,h,c;t===void 0&&(t=!0);var f={},e={},o=!1;for(this.setChangeEvents(!1),this._unselectableCount=0,i=0;i<n.length;i++)r=n[i],r&&(s=this.getKey(r,i),s&&(f[s]=i)),e[i]=r&&!this.canSelectItem(r),e[i]&&this._unselectableCount++;t&&this.setAllSelected(!1);h={};for(c in this._exemptedIndices)if(this._exemptedIndices.hasOwnProperty(c)){var u=Number(c),r=this._items[u],a=r?this.getKey(r,Number(u)):undefined,l=a?f[a]:u;if(l===undefined){this.setAllSelected(!1);break}else h[l]=!0,o=o||l!==u}this._exemptedIndices=h;this._keyToIndexMap=f;this._unselectableIndices=e;this._items=n||[];this._selectedItems=null;o&&this._change();this.setChangeEvents(!0)},n.prototype.getItems=function(){return this._items},n.prototype.getSelection=function(){var t,n;if(!this._selectedItems&&(this._selectedItems=[],t=this._items,t))for(n=0;n<t.length;n++)this.isIndexSelected(n)&&this._selectedItems.push(t[n]);return this._selectedItems},n.prototype.getSelectedCount=function(){return this._isAllSelected?this._items.length-this._exemptedCount-this._unselectableCount:this._exemptedCount},n.prototype.getSelectedIndices=function(){var t,n;if(!this._selectedIndices&&(this._selectedIndices=[],t=this._items,t))for(n=0;n<t.length;n++)this.isIndexSelected(n)&&this._selectedIndices.push(n);return this._selectedIndices},n.prototype.isRangeSelected=function(n,t){var r,i;if(t===0)return!1;for(r=n+t,i=n;i<r;i++)if(!this.isIndexSelected(i))return!1;return!0},n.prototype.isAllSelected=function(){var n=this._items.length-this._unselectableCount;return this.mode===i.SelectionMode.single&&(n=Math.min(n,1)),this.count>0&&this._isAllSelected&&this._exemptedCount===0||!this._isAllSelected&&this._exemptedCount===n&&n>0},n.prototype.isKeySelected=function(n){var t=this._keyToIndexMap[n];return this.isIndexSelected(t)},n.prototype.isIndexSelected=function(n){return!!(this.count>0&&this._isAllSelected&&!this._exemptedIndices[n]&&!this._unselectableIndices[n]||!this._isAllSelected&&this._exemptedIndices[n])},n.prototype.setAllSelected=function(n){if(!n||this.mode===i.SelectionMode.multiple){var t=this._items?this._items.length-this._unselectableCount:0;this.setChangeEvents(!1);t>0&&(this._exemptedCount>0||n!==this._isAllSelected)&&(this._exemptedIndices={},(n!==this._isAllSelected||this._exemptedCount>0)&&(this._exemptedCount=0,this._isAllSelected=n,this._change()),this._updateCount());this.setChangeEvents(!0)}},n.prototype.setKeySelected=function(n,t,i){var r=this._keyToIndexMap[n];r>=0&&this.setIndexSelected(r,t,i)},n.prototype.setIndexSelected=function(n,t,r){if(this.mode!==i.SelectionMode.none&&(n=Math.min(Math.max(0,n),this._items.length-1),!(n<0)&&!(n>=this._items.length))){this.setChangeEvents(!1);var u=this._exemptedIndices[n],f=!this._unselectableIndices[n];f&&(t&&this.mode===i.SelectionMode.single&&this.setAllSelected(!1),u&&(t&&this._isAllSelected||!t&&!this._isAllSelected)&&(delete this._exemptedIndices[n],this._exemptedCount--),u||(!t||this._isAllSelected)&&(t||!this._isAllSelected)||(this._exemptedIndices[n]=!0,this._exemptedCount++),r&&(this._anchoredIndex=n));this._updateCount();this.setChangeEvents(!0)}},n.prototype.selectToKey=function(n,t){this.selectToIndex(this._keyToIndexMap[n],t)},n.prototype.selectToIndex=function(n,t){if(this.mode!==i.SelectionMode.none){if(this.mode===i.SelectionMode.single){this.setIndexSelected(n,!0,!0);return}var u=this._anchoredIndex||0,r=Math.min(n,u),f=Math.max(n,u);for(this.setChangeEvents(!1),t&&this.setAllSelected(!1);r<=f;r++)this.setIndexSelected(r,!0,!1);this.setChangeEvents(!0)}},n.prototype.toggleAllSelected=function(){this.setAllSelected(!this.isAllSelected())},n.prototype.toggleKeySelected=function(n){this.setKeySelected(n,!this.isKeySelected(n),!0)},n.prototype.toggleIndexSelected=function(n){this.setIndexSelected(n,!this.isIndexSelected(n),!0)},n.prototype.toggleRangeSelected=function(n,t){var u,f,r;if(this.mode!==i.SelectionMode.none&&(u=this.isRangeSelected(n,t),f=n+t,this.mode!==i.SelectionMode.single||!(t>1))){for(this.setChangeEvents(!1),r=n;r<f;r++)this.setIndexSelected(r,!u,!1);this.setChangeEvents(!0)}},n.prototype._updateCount=function(){var n=this.getSelectedCount();n!==this.count&&(this.count=n,this._change());this.count||this.setModal(!1)},n.prototype._change=function(){this._changeEventSuppressionCount===0?(this._selectedItems=null,this._selectedIndices=undefined,r.EventGroup.raise(this,i.SELECTION_CHANGE),this._onSelectionChanged&&this._onSelectionChanged()):this._hasChanged=!0},n}();t.Selection=u});

