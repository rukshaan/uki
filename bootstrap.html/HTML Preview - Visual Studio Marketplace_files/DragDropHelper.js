define("OfficeFabric/utilities/dragdrop/DragDropHelper",["require","exports","react-dom","../../Utilities"],function(n,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=25,e=0,u=1,o=function(){function n(n){this._selection=n.selection;this._dragEnterCounts={};this._activeTargets={};this._lastId=0;this._distanceSquaredForDrag=typeof n.minimumPixelsForDrag=="number"?n.minimumPixelsForDrag*n.minimumPixelsForDrag:f;this._events=new r.EventGroup(this);this._events.on(document.body,"mouseup",this._onMouseUp.bind(this),!0);this._events.on(document,"mouseup",this._onDocumentMouseUp.bind(this),!0)}return n.prototype.dispose=function(){this._events.dispose()},n.prototype.subscribe=function(n,t,i){var u=this,nt=i.key,r=nt===void 0?""+ ++this._lastId:nt,tt=[],v,y,p,f,w,b,k,s,h,e,l,d,g,a;if(i&&n){var it=i.eventMap,rt=i.context,c=i.updateDropState,o={root:n,options:i,key:r};if(s=this._isDraggable(o),h=this._isDroppable(o),(s||h)&&it)for(l=0,d=it;l<d.length;l++){g=d[l];a={callback:g.callback.bind(null,rt),eventName:g.eventName};tt.push(a);this._events.on(n,a.eventName,a.callback)}if(h){y=function(n){n.isHandled||(n.isHandled=!0,u._dragEnterCounts[r]--,u._dragEnterCounts[r]===0&&c(!1,n))};p=function(n){n.preventDefault();n.isHandled||(n.isHandled=!0,u._dragEnterCounts[r]++,u._dragEnterCounts[r]===1&&c(!0,n))};f=function(n){u._dragEnterCounts[r]=0;c(!1,n)};w=function(n){if(u._dragEnterCounts[r]=0,c(!1,n),i.onDrop)i.onDrop(i.context.data,n)};b=function(n){n.preventDefault()};this._dragEnterCounts[r]=0;t.on(n,"dragenter",p);t.on(n,"dragleave",y);t.on(n,"dragend",f);t.on(n,"drop",w);t.on(n,"dragover",b)}if(s){k=this._onMouseDown.bind(this,o);f=this._onDragEnd.bind(this,o);v=function(t){t.dataTransfer.setData("id",n.id)};t.on(n,"dragstart",v);t.on(n,"mousedown",k);t.on(n,"dragend",f)}e={target:o,dispose:function(){var i,o,c;if(u._activeTargets[r]===e&&delete u._activeTargets[r],n){for(i=0,o=tt;i<o.length;i++)c=o[i],u._events.off(n,c.eventName,c.callback);h&&(t.off(n,"dragenter",p),t.off(n,"dragleave",y),t.off(n,"dragend",f),t.off(n,"dragover",b),t.off(n,"drop",w));s&&(t.off(n,"dragstart",v),t.off(n,"mousedown",k),t.off(n,"dragend",f))}}};this._activeTargets[r]=e}return{key:r,dispose:function(){e&&e.dispose()}}},n.prototype.unsubscribe=function(n,t){var i=this._activeTargets[t];i&&i.dispose()},n.prototype._onDragEnd=function(n,t){var i=n.options;if(i.onDragEnd)i.onDragEnd(i.context.data,t)},n.prototype._onMouseUp=function(){var n,i,u,t;if(this._isDragging=!1,this._dragData){for(n=0,i=Object.keys(this._activeTargets);n<i.length;n++)u=i[n],t=this._activeTargets[u],t.target.root&&(this._events.off(t.target.root,"mousemove"),this._events.off(t.target.root,"mouseleave"));this._dragData.dropTarget&&(r.EventGroup.raise(this._dragData.dropTarget.root,"dragleave"),r.EventGroup.raise(this._dragData.dropTarget.root,"drop"))}this._dragData=null},n.prototype._onDocumentMouseUp=function(n){n.target===document.documentElement&&this._onMouseUp(n)},n.prototype._onMouseMove=function(n,t){var o=t.buttons,h=o===void 0?u:o,f,e;if(this._dragData&&h!==u){this._onMouseUp(t);return}var s=n.root,i=n.options,c=n.key;if(this._isDragging)this._isDroppable(n)&&this._dragData&&(this._dragData.dropTarget&&this._dragData.dropTarget.key!==c&&!this._isChild(s,this._dragData.dropTarget.root)&&(r.EventGroup.raise(this._dragData.dropTarget.root,"dragleave"),this._dragData.dropTarget=undefined),this._dragData.dropTarget||(r.EventGroup.raise(s,"dragenter"),this._dragData.dropTarget=n));else if(this._dragData&&this._isDraggable(n)&&(f=this._dragData.clientX-t.clientX,e=this._dragData.clientY-t.clientY,f*f+e*e>=this._distanceSquaredForDrag&&this._dragData.dragTarget&&(this._isDragging=!0,i.onDragStart)))i.onDragStart(i.context.data,i.context.index,this._selection.getSelection(),t)},n.prototype._onMouseLeave=function(n){this._isDragging&&this._dragData&&this._dragData.dropTarget&&this._dragData.dropTarget.key===n.key&&(r.EventGroup.raise(n.root,"dragleave"),this._dragData.dropTarget=undefined)},n.prototype._onMouseDown=function(n,t){var r,u,f,i;if(t.button===e)if(this._isDraggable(n)){for(this._dragData={clientX:t.clientX,clientY:t.clientY,eventTarget:t.target,dragTarget:n},r=0,u=Object.keys(this._activeTargets);r<u.length;r++)if(f=u[r],i=this._activeTargets[f],i.target.root){this._events.on(i.target.root,"mousemove",this._onMouseMove.bind(this,i.target));this._events.on(i.target.root,"mouseleave",this._onMouseLeave.bind(this,i.target))}}else this._dragData=null},n.prototype._isChild=function(n,t){for(var u=i.findDOMNode(n),r=i.findDOMNode(t);r&&r.parentElement;){if(r.parentElement===u)return!0;r=r.parentElement}return!1},n.prototype._isDraggable=function(n){var t=n.options;return!!(t.canDrag&&t.canDrag(t.context.data))},n.prototype._isDroppable=function(n){var t=n.options,i=this._dragData&&this._dragData.dragTarget?this._dragData.dragTarget.options.context:undefined;return!!(t.canDrop&&t.canDrop(t.context,i))},n}();t.DragDropHelper=o});

